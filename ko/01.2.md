#1.2 $GOPATH와 워크스페이스

## $GOPATH

Go는 코드 파일을 관리하기위해 `$GOPATH`라고 불리는 독특한 접근 방식을 취합니다. `$GOPATH` 디렉토리안에는 컴퓨터안의 모든 Go 코드가 들어있습니다. 단 Go가 어디에 설치되어 있는지를 나타내는 `$GOROOT` 환경변수와는 다릅니다. 우선 우리는 Go를 사용하기전에 `$GOPATH` 변수를 정의해야합니다. *nix 시스템에서는 `.bashrc`라는 파일이 있고 이 파일에 변수를 추가해야합니다. `$GOPATH`라는 것은 완전히 새로운 개념이며 이는 어디에서든 우리가 Go 코드들을 가져다 쓸 수 있게 만들어 줍니다.

Go 1.8 버전부터 GOPATH를 따로 설정하지 않는 경우 기본값으로 설정됩니다. Unix에서는 `$HOME/go`, 윈도우에서는 `%USERPROFILE%/go`로 기본 설정되어 있습니다.

Unix 계열 시스템에서 변수는 다음과 같이 사용되어야합니다.

```sh
export GOPATH=/home/apple/mygo
```
	
윈도우에서는 GOPATH라는 새 환경변수를 만들어야합니다. 그 값을 `c:/mygo`로 설정하세요 ( ***단, 이 값은 개인 작업 공간의 위치에 따라 다릅니다.*** )

$GOPATH에 하나 이상의 경로 (작업 공간)을 가지는 것은 괜찮지만 `:`(윈도우에선 `;`)를 사용해서 경로를 나눠줘야 한다는 것을 기억하세요. 이때 `go get`으로 저장한 내용들은 $GOPATH의 첫 번째 경로에 저장됩니다. 그래서 여러가지 버전을 같이 사용하지 않는 것이 좋습니다. 최악의 경우는 $GOPATH에서 프로젝트 이름으로 폴더를 생성하는 것입니다. $GOPATH안에 폴더를 생성하면 작성자가 당신의 프로젝트를 참조하는 패키지를 직접 설치하면 패키지를 가져 오는 모든 응용 프로그램이 중단됩니다. 왜냐면 `go get`이 패키지를 어디에서도 찾을 수 없기 때문입니다. 그러니 부디 규칙을 따르세요 규칙이 만들어졌을땐 다 이유가 있습니다.

In $GOPATH, you must have three folders as follows.

$GOPATH안에는 다음과 같은 세 개의 폴더가 반드시 있어야합니다.

- 파일 확장자가 .go, .c, .g, .s인 경우 `src` 폴더에 위치합니다.
- 파일 확장자가 .a인 컴파일 된 파일의 경우 `pkg` 폴더에 위치합니다.
- 실행 파일은 `bin` 폴더에 위치합니다.

이 책에서 저자는 저자의 고유한 $GOPATH 경로인 `mygo`를 사용할 것입니다.

## 패키지 디렉토리

`$GOPATH/src/mymath/sqrt.go`와 같은 패키지 소스 파일과 폴더를 만듭니다. (`mymath`는 패키지 이름입니다.) ( ***저자는 패키지 이름으로`mymath`를 사용하고 패키지 소스 파일을 포함하는 폴더와 동일한 이름을 사용합니다***)

패키지를 생성 할 때마다 `src` 폴더에 새로운 폴더를 생성해야하는데, 꼭 만들어야하는 main을 제외하고 `main` 폴더를 만드는 것은 선택 사항입니다. 폴더 이름은 일반적으로 사용할 패키지와 같습니다. 원하는 경우 계층구조를 지닌 폴더를 만들 수 있습니다. 예를 들어 `$GOPATH/src/github.com/astaxie/beedb` 디렉토리를 생성하면 패키지 경로는 `github.com/astaxie/beedb`가됩니다. 패키지 이름은 경로의 마지막 폴더이며, 이 경우엔 `beedb`가 됩니다.

다음의 명령어를 실행하세요. ( ***작성자는 이야기 예제로 돌아갑니다.*** )

```sh
cd $GOPATH/src
mkdir mymath
```

`sqrt.go`라는 새로운 파일을 생성하고, 다음 내용을 파일에 입력하세요.

```go
// Source code of $GOPATH/src/mymath/sqrt.go
package mymath
	
func Sqrt(x float64) float64 {
	z := 0.0
	for i := 0; i < 1000; i++ {
		z -= (z*z - x) / (2 * x)
    }
    return z
}
```

이제 패키지 폴더가 만들어졌고 코드가 작성되었습니다. 패키지에 대해 해당 폴더와 동일한 이름을 사용하고 폴더에 모든 패키지 소스 파일이 포함되도록하는 것이 좋습니다.

## 패키지 컴파일하기

우리는 이미 위에서 패키지를 만들었습니다. 하지만 어떻게 우리는 연습 목적으로 컴파일을 할 수 있을까요? 여기에 두가지 방법이 있습니다.

1. 작업 경로를 패키지의 폴더로 전환 한 다음, `go install` 명령어를 실행하세요.
2. 파일 이름을 제외하고 `go install mymath`와 같은 명령어를 실행하세요.  

컴파일이 끝나면 다음 폴더를 열 수 있습니다.

```go
cd $GOPATH/pkg/${GOOS}_${GOARCH}
// you can see the file was generated
mymath.a
```
	
파일 확장자가 `.a`인 파일은 우리 패키지의 바이너리 파일입니다. 이걸 어떻게 사용해야 할까요?

맞습니다. 우리는 그것을 사용하기 위해 새로운 애플리케이션을 만들어야합니다.

`mathapp`이라는 새로운 애플리케이션 패키지를 만듭니다.

```go
cd $GOPATH/src
mkdir mathapp
cd mathapp
vim main.go
```
	
`main.go`파일에 다음 내용을 작성하세요.

```go
//$GOPATH/src/mathapp/main.go source code.
package main

import (
    "mymath"
    "fmt"
)

func main() {
    fmt.Printf("Hello, world. Sqrt(2) = %v\n", mymath.Sqrt(2))
}
```
	
이 애플리케이션을 컴파일 하려면 여러분은 `$GOPATH/src/mathapp` 폴더로 이동한 다음 `go install` 명령어를 실행해야합니다. 이제 `$GOPATH/bin/` 폴더에 `mathapp`이라는 실행 파일이 생성 된 것을 볼 수 있습니다. `./mathapp` 명령어를 이용해서 이 프로그램을 실행할 수 있고 실행 후 여러분에 터미널에서 아래와 같은 내용을 볼 수 있습니다.

```sh
Hello world. Sqrt(2) = 1.414213562373095
```
	
## 원격 패키지 설치

Go는 원격 패키지를 설치하기위한 `go get`이라는 도구를 가지고 있습니다. Github, Google Code, BitBucket 및 Launchpad를 포함한 대부분의 오픈 소스 커뮤니티를 지원합니다.

```sh
go get github.com/astaxie/beedb
```
	
여러분은 `go get -u …`를 사용하여 원격 패키지를 업데이트 할 수 있으며, 모든 종속 패키지도 자동으로 설치할 수 있습니다.

이 도구는 다양한 오픈 소스 플랫폼에 맞춰 서로 다른 VCT(Version Control Tool)를 사용합니다. 예를 들어 Github을 사용할 땐 `git`을, Google Code를 사용할 땐 `hg`를 사용합니다. 그러므로 `go get`을 사용하기 전에 이용할 VCT를 설치해야합니다.

위의 명령어를 실행 한 후 디렉토리 구조는 다음과 같아야합니다.

	$GOPATH
		src
		 |-github.com
		 	 |-astaxie
		 	 	 |-beedb
		pkg
		 |--${GOOS}_${GOARCH}
		 	 |-github.com
		 	 	 |-astaxie
		 	 	 	 |-beedb.a
		 	 	 	 
사실, `go get`은 로컬 `$GOPATH/src`에 소스 코드를 복제하고 `go install` 명령어를 실행합니다.

로컬 패키지를 사용하는 것과 같은 방법으로 원격 패키지를 사용할 수 있습니다.

```go
	import "github.com/astaxie/beedb"
```
	
## 완성된 폴더 구조

위의 모든 단계를 수행 한 경우 디렉토리 구조는 다음과 같아야합니다.

	bin/
		mathapp
	pkg/
		${GOOS}_${GOARCH}, such as darwin_amd64, linux_amd64
      mymath.a
      github.com/
        astaxie/
          beedb.a
	src/
		mathapp
			main.go
		mymath/
			sqrt.go
		github.com/
			astaxie/
				beedb/
					beedb.go
					util.go
					
이제 디렉토리 구조를 명확하게 볼 수 있습니다. `bin`은 실행 파일을 포함하고, `pkg`는 컴파일 된 파일을 포함하고, `src`는 패키지 소스 파일을 포함합니다.

(윈도우 사용자일경우 환경 변수 형식이 `%GOPATH%`이지만, 이 책은 주로 Unix 계열을 따르므로 윈도우 사용자는 자신에게 맞게 고쳐 생각해야합니다.)

## Links

- [목차](preface.md)
- 이전 글: [설치](01.1.md)
- 다음 글: [Go 명령어](01.3.md)
